---
title: "Core Web Vitals Module"
sidebar_position: 300
hide_title: true
---

```mdx-code-block
import Badges from '@site/src/components/Badges';
```
<Badges badgeType="dbt-package Release" pkg="web"></Badges>

```mdx-code-block
import { Accelerator } from "@site/src/components/AcceleratorAdmonitions";

<Accelerator href="https://docs.snowplow.io/accelerators/web-performance/" name="Web Performance"/>
```

# Core Web Vitals Custom Module

This custom module is built as an extension of the [dbt-snowplow-unified package](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-models/dbt-unified-data-model/index.md), it transforms raw `web vitals` event data into derived tables for easier querying. These events are generated by the **Snowplow Web Vitals plugin** (@snowplow/browser-plugin-web-vitals) of the [JavaScript tracker](/docs/collecting-data/collecting-from-own-applications/javascript-trackers/index.md).

To enable this optional module, the web package must be correctly configured. Please refer to the [snowplow-unified dbt quickstart guide](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-quickstart/web/index.md) for a full breakdown of how to set it up.

## Prerequisites

In order to use this module you would need to:

1. Track core web vitals using the web `Snowplow Web Vitals plugin`, which populates the column/table `unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1`
2. Have the [yauaa enrichment](/docs/enriching-your-data/available-enrichments/yauaa-enrichment/index.md) enabled (for device type and device class), which populates `contexts_com_snowplowanalytics_snowplow_yauaa_context_1`
3. (Ideally, but not necessarily) Have the [spiders and bots](/docs/enriching-your-data/available-enrichments/iab-enrichment/index.md) enrichment enabled, which populates `contexts_com_iab_snowplow_spiders_and_robots_1`

## Overview

This custom module consists of a series of dbt models which produce the following aggregated models from the raw web vitals events:

- `snowplow_web_vitals`: Incremental table used as a base for storing core web vital events (first event per page view).

- `snowplow_web_vital_measurements`: Drop and recompute table to use for visualizations that takes core web vital measurements at the user specified percentile point (defaulted to 75).


## Operation

It is assumed that the dbt_snowplow_unified package is already installed and configured as per the [Quick Start](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-quickstart/index.md) instructions.


### Enable the module

You can enable the custom module through the `snowplow__enable_cwv` variable in your `dbt_project.yml` file:

```yml title="dbt_project.yml"

vars:
  snowplow_unified:
    snowplow__enable_cwv: true
```

### Override the module specific macros

:::tip

For information about overriding our macros, see [here](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-operation/macros-and-keys/index.md#overriding-macros)

:::

- The `core_web_vital_page_groups()`[source](https://github.com/snowplow/dbt-snowplow-unified/blob/main/macros/core_web_vital_page_groups.sql) macro is used to let the user classify their urls to specific page groups. It returns the sql to provide the classification (expected in the form of case when statements).

- The `core_web_vital_results_query()`[source](https://github.com/snowplow/dbt-snowplow-unified/blob/main/macros/core_web_vital_results_query.sql) macro is used to let the user classify the tresholds to be applied for the measurements. It returns the sql to provide the logic for the evaluation based on user defined tresholds (expected in the form of case when statements).

Please make sure you set the results you would like the measurements to pass to **`good`** or align it with the `macro_core_web_vital_pass_query()` macro.

- The `core_web_vital_pass_query()`[source](https://github.com/snowplow/dbt-snowplow-unified/blob/main/macros/core_web_vital_pass_query.sql)

```sql
case when lcp_result = 'good' and fid_result = 'good' and cls_result = 'good' then 1 else 0 end passed
```

###  Run the module
If you have previously run the unified model without this optional module enabled, you can simply enable the module and run `dbt run --selector snowplow_unified` as many times as needed for this module to catch up with your other data. If you only wish to process this from a specific date, be sure to change your `snowplow__start_date`, or refer to the [Custom module](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-custom-models/index.md) section for a detailed guide on how to achieve this the most efficient way.

If you haven't run the web package before, then you can run it using `dbt run --selector snowplow_unified` either through your CLI, within dbt Cloud, or for Enterprise customers you can use the BDP console. In this situation, all models will start in-sync as no events have been processed.
