---
title: "The Web data model"
date: "2021-07-27"
sidebar_position: 101
---

# Snowplow Web Package

**The package source code can be found in the [snowplow/dbt-snowplow-web repo](https://github.com/snowplow/dbt-snowplow-web), and the docs for the [model design here](https://snowplow.github.io/dbt-snowplow-web/#!/overview/snowplow_web).**

The package contains a fully incremental model that transforms raw web event data generated by the [Snowplow JavaScript tracker](/docs/collecting-data/collecting-from-own-applications/javascript-trackers/index.md) into a series of derived tables of varying levels of aggregation.

The Snowplow web data model aggregates Snowplow's out of the box page view and page ping events to create a set of derived tables - page views, sessions and users - that contain many useful dimensions as well as calculated measures such as time engaged and scroll depth.

![](images/image-3.png)

## Overview

This model consists of a series of modules, each producing a table which serves as the input to the next module. The 'standard' modules are:

- Base: Performs the incremental logic, outputting the table `snowplow_web_base_events_this_run` which contains a de-duped data set of all events required for the current run of the model.
- Page Views: Aggregates event level data to a page view level, `page_view_id`, outputting the table `snowplow_web_page_views`.
- Sessions: Aggregates page view level data to a session level, `domain_sessionid`, outputting the table `snowplow_web_sessions`.
- Users: Aggregates session level data to a users level, `domain_userid`, outputting the table `snowplow_web_users`.
- User Mapping: Provides a mapping between user identifiers, `domain_userid` and `user_id`, outputting the table `snowplow_web_user_mapping`. This can be used for session stitching.

## Optional Modules

### Consent Tracking Custom Module

:::info BigQuery and Snowflake Only
The module is currently only available for use in BigQuery and Snowflake. Further adapter support coming shortly.
:::

### Introduction

This custom module is built as an extension of the [dbt-snowplow-web package](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-models/dbt-web-data-model/index.md), it transforms raw `consent_preferences` and `cmp_visible` event data into derived tables for easier querying. These events are generated by the **Enhanced Consent plugin**] of the [JavaScript tracker](/docs/collecting-data/collecting-from-own-applications/javascript-trackers/index.md).

:::info Important
For the incremental logic to work within the module you **must** use at least `RDB Loader v4.0.0`, as the custom module relies on the additional `load_tstamp` field for dbt native incrementalisation.

Whenever a new consent version is added to be tracked, the model expects an `allow_all` event in order to attribute the events to the full list of latest consent scopes. It is advisable to send a test event of that kind straight after deployment so that the model can process the data accurately.
:::

To enable this optional module, the web package must be correctly configured. Please refer to the [snowplow-web dbt docs](/docs/modeling-your-data/modeling-your-data-with-dbt/index.md) for a full breakdown of how to set it up.

### Overview

This custom module consists of a series of dbt models which produce the following aggregated models from the raw consent tracking events:

  - `snowplow_web_consent_log`: Snowplow incremental table showing the audit trail of consent and Consent Management Platform (cmp) events

  - `snowplow_web_consent_users`: Incremental table of user consent tracking stats

  - `snowplow_web_consent_totals`: Summary of the latest consent status, per consent version

  - `snowplow_web_consent_scope_status`: Aggregate of current number of users consented to each consent scope

  - `snowplow_web_cmp_stats`: Used for modeling cmp_visible events and related metrics

  - `snowplow_web_consent_versions`: Incremental table used to keep track of each consent version and its validity


### Operation

It is assumed that the dbt_snowplow_web package is already installed and configured as per the [Quick Start](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-quickstart/index.md) instructions.

#### Enable the module

To enable the custom module simply copy the following code snippet to your own dbt_project.yml file:

```yml
# dbt_project.yml

models:
  snowplow_web:
    optional_modules:
      consent:
        enabled: true
        bigquery:
          enabled: "{{ target.type == 'bigquery' | as_bool() }}"
        snowflake:
          enabled: "{{ target.type == 'snowflake' | as_bool() }}"
```

####  Run the module
If you have previously run the web model without this optional module enabled, you can simply enable the module and run `dbt run --selector snowplow_web` as many times as needed for this module to catch up with your other data. If you only wish to process this from a specific date, be sure to change your `snowplow__start_date`, or refer to the [Custom module](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-custom-models/index.md) section for a detailed guide on how to achieve this the most efficient way.

If you haven't run the web package before, then you can run it using `dbt run --selector snowplow_web` either through your CLI, within dbt Cloud, or for Enterprise customers you can use the BDP console. In this situation, all models will start in-sync as no events have been processed.
