---
title: "Consent Module"
sidebar_position: 101
hide_title: true
---

```mdx-code-block
import Badges from '@site/src/components/Badges';
```
<Badges badgeType="dbt-package Release" pkg="web"></Badges>


# Core Web Vitals Custom Module

This custom module is built as an extension of the [dbt-snowplow-web package](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-models/dbt-web-data-model/index.md), it transforms raw `consent_preferences` and `cmp_visible` event data into derived tables for easier querying. These events are generated by the **Snowplow Web Vitals plugin** (@snowplow/browser-plugin-web-vitals) of the [JavaScript tracker](/docs/collecting-data/collecting-from-own-applications/javascript-trackers/index.md).

To enable this optional module, the web package must be correctly configured. Please refer to the [snowplow-web dbt quickstart guide](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-quickstart/web/index.md) for a full breakdown of how to set it up.

## Prerequisites

In order to use this module you would need to:

1. track core web vitals using the web `Snowplow Web Vitals plugin` - unstruct_event_com_snowplowanalytics_snowplow_web_vitals_1
2. have `yauaa enrichment enabled` (for device type and device class) - contexts_com_snowplowanalytics_snowplow_yauaa_context_1
3. have `spiders and bots enrichments enabled` - contexts_com_iab_snowplow_spiders_and_robots_1_0_0

## Overview

This custom module consists of a series of dbt models which produce the following aggregated models from the raw web vitals events:

- `snowplow_web_vitals`: Incremental table used as a base for storing core web vital events (first event per pageview).

- `snowplow_web_vital_measurements`: Drop and recompute table to use for visualisations that takes core web vital measurements at the user specified percentile point (defaulted to 75).


## Operation

It is assumed that the dbt_snowplow_web package is already installed and configured as per the [Quick Start](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-quickstart/index.md) instructions.


### Enable the module

You can enable the custom module through the `snowplow__enable_cwv` variable most conveniently in your dbt_project.yml file:

```yml
# dbt_project.yml

vars:
  snowplow_web:
    snowplow__enable_consent: true
```

### Overwerite the module specific macros

- The `core_web_vital_page_groups()` macro is used to let the user classify their urls to specific page groups. It returns the sql to provide the classification (expected in the form of case when statements).

- The `core_web_vital_results()` macro is used to let the user classify the tresholds to be applied for the measurements. It returns the sql to provide the logic for the evaluation based on user defined tresholds (expected in the form of case when statements).

Please make sure you equal the results you would like the measurements to pass to `good` due to the following logic that gets evaluated within *snowplow_web_vital_measurements*:

```lcp_result = 'good' and fid_result = 'good' and cls_result = 'good' then 1 else 0 end passed
```

###  Run the module
If you have previously run the web model without this optional module enabled, you can simply enable the module and run `dbt run --selector snowplow_web` as many times as needed for this module to catch up with your other data. If you only wish to process this from a specific date, be sure to change your `snowplow__start_date`, or refer to the [Custom module](/docs/modeling-your-data/modeling-your-data-with-dbt/dbt-custom-models/index.md) section for a detailed guide on how to achieve this the most efficient way.

If you haven't run the web package before, then you can run it using `dbt run --selector snowplow_web` either through your CLI, within dbt Cloud, or for Enterprise customers you can use the BDP console. In this situation, all models will start in-sync as no events have been processed.
